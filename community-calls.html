<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Blocksense Community Calls - Blocksense Network Monitor</title>
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <!-- Hard-looking font for the whole app -->
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    <!-- Styles -->
    <link rel="stylesheet" href="light.css"/>
    <style>
        /* TAM EKRAN DÜZENİ */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            background: var(--bg-color);
            /* overflow: hidden; REMOVED THIS LINE TO ENABLE SCROLLING */
        }
        
        .container {
            width: 100%;
            min-height: 100vh; /* Changed from height: 100vh to min-height */
            padding: 0;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            flex-shrink: 0;
            padding: 15px 30px;
            background: var(--container-bg);
            border-bottom: 2px solid var(--border-color);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .back-button {
            margin: 0;
        }
        
        /* Başlık ve tarih düzenlemesi */
        .title-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .title-with-date {
            display: flex;
            flex-direction: column;
        }
        
        .call-date {
            font-size: 1.2rem;
            color: var(--update-item-content-color);
            font-weight: 500;
            margin-left: 10px;
        }
        
        /* Ana içerik - tam ekran video ve transcript */
        .main-content {
            flex: 1;
            display: flex;
            padding: 15px;
            gap: 20px;
            /* overflow: hidden; REMOVED THIS LINE */
            height: auto; /* Changed from fixed height to auto */
            min-height: 0; /* Allow content to determine height */
        }
        
        .video-section {
            flex: 3;
            display: flex;
            flex-direction: column;
            background: var(--container-bg);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            /* overflow: hidden; REMOVED THIS LINE */
            height: auto; /* Changed from 100% to auto */
            transform: scale(0.9);
            transform-origin: center;
        }
        
        .transcript-section {
            flex: 2;
            display: flex;
            flex-direction: column;
            background: var(--container-bg);
            border-radius: 12px;
            /* overflow: hidden; REMOVED THIS LINE */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            height: auto; /* Changed from 100% to auto */
            margin-right: 40px; /* Transcript panelini 40px sola kaydır */
        }
        
        /* Video konteyneri - boyut ayarı */
        .video-container-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            justify-content: center;
        }
        
        .video-container {
            width: 100%;
            height: 60%;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin: 0 auto;
            max-height: 450px;
        }
        
        .video-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* Transcript paneli - boyut ayarı */
        .transcript-panel {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            min-height: 0;
            font-size: 15px;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
        }
        
        .transcript-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
            font-size: 1.2rem;
        }
        
        .transcript-content {
            line-height: 1.6;
            font-size: 15px;
            flex: 1;
            overflow-y: auto;
        }
        
        .transcript-content p {
            margin-bottom: 15px;
        }
        
        .transcript-content ul, .transcript-content ol {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .transcript-content li {
            margin-bottom: 8px;
        }
        
        .transcript-placeholder {
            text-align: center;
            padding: 40px 20px;
            color: var(--update-item-content-color);
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            flex: 1;
        }
        
        .transcript-placeholder i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--link-bg);
        }
        
        .close-transcript {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        .loading-spinner {
            text-align: center;
            padding: 40px;
        }
        
        .loading-spinner i {
            font-size: 2rem;
        }
        
        .error-message {
            color: #e53e3e;
            text-align: center;
            padding: 30px;
        }
        
        /* Transcript butonları - ARTIK TRANSCRIPT PANELİNDE */
        .transcript-links {
            padding: 20px;
            margin: 0;
            border-bottom: 2px solid var(--border-color);
        }
        
        .transcript-links h3 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding: 0;
        }
        
        .transcript-buttons {
            display: flex;
            gap: 12px;
            margin: 0;
            padding: 0;
        }
        
        .transcript-buttons button {
            padding: 12px 15px;
            font-size: 0.9rem;
            flex: 1;
            margin: 0;
            border-radius: 8px;
        }
        
        /* Responsive düzenlemeler */
        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
                height: auto; /* Changed from auto to allow content to expand */
            }
            
            .video-section {
                height: auto;
                min-height: 400px;
                border-right: none;
                border-bottom: 2px solid var(--border-color);
                transform: scale(0.95);
            }
            
            .transcript-section {
                height: auto; /* Changed from 40vh to auto */
                min-height: 300px;
                margin-right: 0; /* Mobilde margin'i sıfırla */
            }
            
            .video-container {
                height: 350px;
                max-height: 350px;
            }
            
            .transcript-links {
                padding: 15px;
            }
        }
        
        @media (max-width: 768px) {
            .header {
                padding: 10px 15px;
            }
            
            .main-content {
                padding: 10px;
                gap: 15px;
                overflow: visible; /* Ensure content can overflow */
            }
            
            .video-section,
            .transcript-section {
                padding: 12px;
                height: auto; /* Ensure sections can expand */
            }
            
            .transcript-buttons {
                flex-direction: column;
            }
            
            .video-container {
                height: 250px;
                max-height: 250px;
                margin-bottom: 10px;
            }
            
            .transcript-header {
                font-size: 1.1rem;
            }
            
            .transcript-content {
                font-size: 14px;
            }
            
            .header-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .back-button {
                align-self: flex-end;
            }
            
            .video-section {
                transform: scale(0.95);
            }
            
            .transcript-links {
                padding: 15px 10px;
            }
            
            .transcript-buttons button {
                padding: 10px;
            }
            
            /* Mobilde başlık ve tarih düzenlemesi */
            .title-container {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .call-date {
                margin-left: 0;
                font-size: 1rem;
            }
        }

        /* NEW: Add a wrapper to allow scrolling on mobile */
        .content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto; /* Enable vertical scrolling */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="title-container">
                    <h1 class="modern-header">
                        <img src="pirate.png" alt="Blocksense Network Monitor" class="logo-icon" id="blockIcon"/>
                        Blocksense Community Call #<span id="callNumberDisplay"></span>
                    </h1>
                    <div class="call-date" id="callDateDisplay"></div>
                </div>
                <div class="back-button">
                    <a href="index.html" class="litepaper-link">
                        <i class="fas fa-arrow-left"></i> Back to Main
                    </a>
                </div>
            </div>
        </div>
        
        <div class="content-wrapper"> <!-- NEW: Added wrapper for scrolling -->
            <div class="main-content">
                <div class="video-section">
                    <div class="video-container-wrapper">
                        <div class="video-container">
                            <iframe id="youtubePlayer" width="100%" height="100%" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        </div>
                    </div>
                </div>
                
                <div class="transcript-section">
                    <div class="transcript-links">
                        <h3>Transcripts:</h3>
                        <div class="transcript-buttons">
                            <button id="engTranscriptBtn" class="primary-btn small-btn">
                                <i class="fas fa-file-alt"></i> English Transcript
                            </button>
                            <button id="trTranscriptBtn" class="primary-btn small-btn">
                                <i class="fas fa-file-alt"></i> Türkçe Transcript
                            </button>
                        </div>
                    </div>
                    <div class="transcript-panel" id="transcriptPanel">
                        <div class="transcript-placeholder">
                            <i class="fas fa-file-alt"></i>
                            <h3>Transcript Panel</h3>
                            <p>Select a transcript language to view the content here.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div> <!-- END: content-wrapper -->
    </div>
    
    <button id="themeToggle" class="theme-toggle">
        <i class="fas fa-sun"></i>
    </button>
    
    <script>
        // URL'den call parametresini al
        const urlParams = new URLSearchParams(window.location.search);
        const callNumber = urlParams.get('call');
        
        // Community Call YouTube linkleri
        const youtubeLinks = [
            "https://www.youtube.com/embed/SEUy0ZWxz2k",
            "https://www.youtube.com/embed/Ur97X-0d0fs",
            "https://www.youtube.com/embed/iDeHWx3oyXU",
            "https://www.youtube.com/embed/VKhyEBkCIOE",
            "https://www.youtube.com/embed/VKhyEBkCIOE",
            "https://www.youtube.com/embed/VGjcGeAJNlc",
            "https://www.youtube.com/embed/DxzUVY6kODk",
            "https://www.youtube.com/embed/V_bggpmFq1c",
            "https://www.youtube.com/embed/mKBtSR0oO64",
            "https://www.youtube.com/embed/a3e1oFF_NIo",
            "https://www.youtube.com/embed/dyPuiiOh7KY"
        ];
        
        // Community Call tarihleri
        const callDates = [
            "12 August 2024",
            "8 November 2024",
            "7 December 2024",
            "11 January 2025",
            "6 February 2025",
            "7 March 2025",
            "3 April 2025",
            "5 May 2025",
            "30 May 2025",
            "2 July 2025",
            "31 July 2025"
        ];
        
        // Sayfa yüklendiğinde
        document.addEventListener('DOMContentLoaded', function() {
            if (callNumber && callNumber >= 1 && callNumber <= 11) {
                const video = document.getElementById('youtubePlayer');
                video.src = youtubeLinks[callNumber - 1];
                
                // Call number'ı göster
                document.getElementById('callNumberDisplay').textContent = callNumber;
                
                // Call tarihini göster
                document.getElementById('callDateDisplay').textContent = callDates[callNumber - 1];
                
                document.title = `Blocksense Community Call #${callNumber} - Blocksense Network Monitor`;
                
                // Transcript butonlarına tıklama olaylarını ekle
                document.getElementById('engTranscriptBtn').addEventListener('click', function() {
                    loadTranscript(callNumber, 'ENG');
                });
                
                document.getElementById('trTranscriptBtn').addEventListener('click', function() {
                    loadTranscript(callNumber, 'TR');
                });
            } else {
                document.querySelector('.main-content').innerHTML = `
                    <div class="error-message" style="width: 100%; padding: 40px;">
                        <p>Invalid community call number. Please select a valid call from the main page.</p>
                        <a href="index.html" class="primary-btn">Back to Main Page</a>
                    </div>
                `;
            }
            
            // Tema değiştirme butonu
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                // Mevcut temayı kontrol et
                const savedTheme = localStorage.getItem('theme') || 'light';
                document.documentElement.setAttribute('data-theme', savedTheme);
                
                // İkonu ayarla
                const icon = themeToggle.querySelector('i');
                icon.className = savedTheme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
                
                themeToggle.addEventListener('click', function() {
                    const currentTheme = document.documentElement.getAttribute('data-theme');
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    document.documentElement.setAttribute('data-theme', newTheme);
                    localStorage.setItem('theme', newTheme);
                    
                    // İkonu güncelle
                    icon.className = newTheme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
                });
            }
        });
        
        // Transcript yükleme fonksiyonu
        function loadTranscript(callNumber, language) {
            const transcriptPanel = document.getElementById('transcriptPanel');
            
            // Yükleniyor mesajı göster
            transcriptPanel.innerHTML = `
                <div class="transcript-header">
                    <h3>${language} Transcript</h3>
                    <button class="close-transcript" onclick="closeTranscript()"><i class="fas fa-times"></i></button>
                </div>
                <div class="loading-spinner">
                    <i class="fas fa-spinner fa-spin"></i> Loading transcript...
                </div>
            `;
            
            // Transcript dosya yolunu belirle
            const transcriptPath = `transcripts/${language}/call-${callNumber}.txt`;
            
            // Fetch API ile transcript dosyasını yükle
            fetch(transcriptPath)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Transcript not found');
                    }
                    return response.text();
                })
                .then(data => {
                    // Başarılı yükleme - transcript içeriğini göster
                    transcriptPanel.innerHTML = `
                        <div class="transcript-header">
                            <h3>${language} Transcript</h3>
                            <button class="close-transcript" onclick="closeTranscript()"><i class="fas fa-times"></i></button>
                        </div>
                        <div class="transcript-content">
                            ${formatTranscript(data)}
                        </div>
                    `;
                })
                .catch(error => {
                    // Hata durumunda kullanıcıyı bilgilendir
                    console.error('Transcript loading error:', error);
                    
                    // Örnek içerik göster
                    const sampleContent = language === 'ENG' 
                        ? `<p>This is a sample English transcript for Blocksense Community Call #${callNumber}.</p>
                           <p>In this call, we discussed the latest developments in the Blocksense network, including:</p>
                           <ul>
                             <li>New feature updates</li>
                             <li>Network performance metrics</li>
                             <li>Upcoming roadmap items</li>
                             <li>Community questions and answers</li>
                           </ul>
                           <p>The full transcript will be available here once it's prepared.</p>`
                        : `<p>Bu, ${callNumber}. Blocksense Topluluk Görüşmesi için örnek bir Türkçe transkripttir.</p>
                           <p>Bu görüşmede, Blocksense ağındaki son gelişmeleri tartıştık,包括:</p>
                           <ul>
                             <li>Yeni özellik güncellemeleri</li>
                             <li>Ağ performans metrikleri</li>
                             <li>Yaklaşan yol haritası maddeleri</li>
                             <li>Topluluk soruları ve cevapları</li>
                           </ul>
                           <p>Tam transkript hazır olduğunda burada erişilebilir olacaktır.</p>`;
                    
                    transcriptPanel.innerHTML = `
                        <div class="transcript-header">
                            <h3>${language} Transcript</h3>
                            <button class="close-transcript" onclick="closeTranscript()"><i class="fas fa-times"></i></button>
                        </div>
                        <div class="transcript-content">
                            ${sampleContent}
                            <p class="error-message">Note: This is sample content. The actual transcript file could not be loaded from: ${transcriptPath}</p>
                        </div>
                    `;
                });
        }
        
        // Transcript içeriğini biçimlendirme fonksiyonu
        function formatTranscript(text) {
            // Satır sonlarını <br> etiketlerine dönüştür
            return text.replace(/\n/g, '<br>');
        }
        
        // Transcript panelini kapatma fonksiyonu
        function closeTranscript() {
            const transcriptPanel = document.getElementById('transcriptPanel');
            transcriptPanel.innerHTML = `
                <div class="transcript-placeholder">
                    <i class="fas fa-file-alt"></i>
                    <h3>Transcript Panel</h3>
                    <p>Select a transcript language to view the content here.</p>
                </div>
            `;
        }
    </script>
</body>
</html>